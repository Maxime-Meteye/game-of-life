<?php
header("Cache-Control: no-cache, must-revalidate");
header("Pragma: no-cache");
?>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandbox</title>
    <link rel="stylesheet" href="../style/style.css">
</head>
<body>

<?php 
    include ('../banner.html');
?>
<div id="game_div"></div>
    <canvas id="game_canvas"></canvas>
<script type="module">
import{Canvas,entity} from '../glitchengine/glitch_engine.mjs'
const HEIGHT = 700;
const WIDTH = 1200;
const grid_size = HEIGHT*WIDTH

let c = new Canvas(false,HEIGHT,WIDTH);
let bck_canvas = new Canvas(true,HEIGHT,WIDTH);

const posx = Uint32Array(grid_size)
const posy = Uint32Array(grid_size)
const energy = Uint32Array(grid_size)
const food_top = Uint32Array(grid_size)
const food_right = Uint32Array(grid_size)
const food_bottom = Uint32Array(grid_size)
const food_left = Uint32Array(grid_size)
const age = Uint32Array(grid_size)

class Engine{
    entity_list = [];
    lastFrameTime = performance.now();
    game_loop(){
        const now = performance.now();
        let start = performance.now();
        const frameDuration = now - this.lastFrameTime;
        this.lastFrameTime = now;
        /*
        this.entity_list.forEach((element,index)=>{
            element.update(old_entity_list,index);
            element.build();
        })
        */
        bck_canvas.render(c.context);
        let end = performance.now()
        console.log("Frame duration:", frameDuration.toFixed(2), "ms");
        requestAnimationFrame(()=> this.game_loop())
    }
}

let engine = new Engine();


function init(){
    c.setBackground("250,250,250");
     for(let y=0; y<HEIGHT; y++){
        for(let x=0; x<WIDTH; x++){
            /*
            let cell = new life(bck_canvas)
            cell.mode = "pixel";
            cell.posx = x;
            cell.posy = y;
            let random = Math.random()
            cell.alive = random  > 0.9;
            if(cell.alive){
                alive ++;
            }
            engine.entity_list.push(cell)
            */
        }
        /*
        let pixel = new entity;
        pixel.mode = "pixel";
        pixel.build();
        */
    }
    engine.entity_list.forEach((element,index)=>{
        element.update(engine.entity_list,index)
        element.build();
    })
}
init()
//bck_canvas.render(c.context);

engine.game_loop();
//console.log("after :",engine.entity_list[2])
//console.log("alive", alive);


</script>
</body>
</html>