<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandbox</title>
    <link rel="stylesheet" href="../style/style.css">
</head>
<body>

<?php 
    include ('../banner.html');
?>
<div id="game_div"></div>
    <canvas id="game_canvas"></canvas>
<script type="module">
import{Canvas,entity} from '../glitchengine/glitch_engine.mjs'

const HEIGHT = 700;
const WIDTH = 1200;

class Engine{
    particle_array =[]
    game_loop(){
        let start = performance.now();
        bck_canvas.render(c.context);
        let end = performance.now()
        //console.log("Made in this time:",end-start,);
        //bck_canvas.setBackground('30,100,120')
        explosion1.update()
        explosion1.renderExplosion()
        requestAnimationFrame(()=> this.game_loop())
    }
}

class explosion extends entity{
    force = 2;
    red = 250
    green = 0;
    color = `250,0,0`
    constructor(bck_canvas) {
        super(bck_canvas);
    }

    renderExplosion(){
            bck_canvas.buildCircle(this.posx,this.posy,1*this.force, this.color)
    }
    update(){
        if(this.force <= 30){
            this.color = `${this.red},${this.green},0`
            this.force ++;
        }else{
            this.green += 1
            this.color = `${this.red},${this.green},0`
        }
        if(this.force > 0){
            this.renderExplosion();
        }

    }
}
let iterator = 0
//TODO créer des particules placés aléatoirement autour du centre et les faire aller vers l'extérieur du centre
function makeExplosionParticle(nb_particle,center,max_distance){
    console.log(iterator)
    console.log(nb_particle)
    for( iterator = 0; iterator<=nb_particle; iterator++ ){
        console.log("before",5,explosion1.posx,0)
        let particle = new entity(bck_canvas);
        particle.posx = center.posx
        particle.posy = center.posy
        particle.mode = "pixel"
        particle.build();
    }
}

let c = new Canvas(false, HEIGHT, WIDTH);
let bck_canvas = new Canvas(true, HEIGHT, WIDTH);
let explosion1 = new explosion(bck_canvas);
let engine = new Engine();
//c.setBackground("250,250,250");

explosion1.posx = 500;
explosion1.posy = 500;
explosion1.renderExplosion()
makeExplosionParticle(5,{
    posx: explosion1.posx,
    posy: explosion1.posy
},5)



engine.game_loop();

</script>